# 乒乓球智能计分系统

基于计算机视觉和语音识别技术的智能乒乓球比赛计分系统，可以自动识别手势和语音指令，实现自动计分、实时比分显示及发球方提示播报功能。

## 功能特点

- **姿态识别**：通过摄像头实时检测选手的特定手势（触摸球桌动作）来判断得分
- **语音识别**：识别用户的语音指令（如"A得分"、"好球"、"goal"等）实现语音计分
- **实时显示**：大字体显示比分、发球方提示和冷却倒计时
- **智能规则**：自动执行乒乓球比赛规则（如每2分换发球，11分制等）
- **防误判机制**：设置冷却期防止短时间内重复计分

## 技术架构

- **前端/UI**: OpenCV绘图 + Pillow（图像处理）
- **后端逻辑**: Python原生 + NumPy（数值计算）
- **姿态识别**: MediaPipe Hands（21个关键点检测）
- **语音识别**: SpeechRecognition库（Google语音API）
- **开发语言**: Python 3.7+

## 安装说明

1. 确保已安装Python 3.7+
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```
   
3. 连接摄像头和麦克风设备

## 使用方法

运行主程序：
```bash
python main_table_tennis_scorer.py
```

或运行增强版：
```bash
python advanced_scorer.py
```

### 控制方式：

- **姿态识别**：面向摄像头做"触摸桌面"手势
- **语音识别**：说出预设关键词（如"得分"、"好球"、"goal"等）
- **键盘控制**：
  - `q`: 退出程序
  - `r`: 重置比分
  - `s`: 切换手势类型（仅增强版）
  - `h`: 显示历史记录（仅增强版）

### 比赛规则

- 采用11分制，需领先2分获胜
- 每得2分后交换发球权
- 得分后有3秒冷却期，防止重复计分

## 配置参数

可在 [config.py](./config.py) 文件中调整以下参数：

- 摄像头设置
- 姿态识别参数
- 语音识别参数
- 游戏规则参数
- UI显示参数
- 调试选项

## 中文乱码问题解决

如果在Windows系统上出现中文乱码问题，请尝试以下解决方案：

1. **设置控制台代码页为UTF-8**：
   ```cmd
   chcp 65001
   ```

2. 或者在Python运行时指定编码：
   ```cmd
   python -X utf8 main_table_tennis_scorer.py
   ```

3. 如果仍有问题，可以设置环境变量：
   ```cmd
   set PYTHONIOENCODING=utf-8
   python main_table_tennis_scorer.py
   ```

4. 或者在IDE中运行时，确保控制台编码设置为UTF-8

系统会自动尝试设置正确的编码以支持中文显示。

## 注意事项

- 确保光线充足，摄像头视野清晰
- 语音识别需要互联网连接
- 需要在相对安静的环境中使用语音功能
- 建议在固定位置放置摄像头以获得最佳识别效果
- 如遇PyAudio安装问题，程序将继续运行但语音识别功能将被禁用
- 在Windows系统上，如果遇到中文乱码问题，请参考上面的解决方案

## 扩展功能

- 未来可添加手势类型切换功能
- 可增加更多语音关键词自定义
- 支持比赛历史记录保存
- 添加更多视觉反馈效果

## 已知问题

- 在光线不足环境下姿态识别可能不稳定
- 语音识别对背景噪音敏感
- 需要优化多人场景下的识别精度
- Windows系统下可能出现中文显示问题

## 开发计划

1. 增加更多的手势识别类型
2. 提供更灵活的语音关键词配置
3. 增加网络功能，支持远程计分
4. 添加回放和统计功能